<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Game</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
<div>
    <div class="game-display">
        <div class="game-display-properties">
            <p><strong>Round</strong>: {{ game["round"] }}</p>
            <p><strong>State</strong>: {{ game["state"] }}</p>
            <p><strong>Character turn</strong>: {{ game["character_turn"] }}</p>

            {% if host and game["state"] == "created" %}
            <form action="{{ url_for('start_game', game_uuid=game['uuid'], player_uuid=player_uuid) }}" method="post">
                <div class="home-button">
                    <input type="submit" name="start" value="Start" class="game-buttons"/>
                </div>
            </form>
            {% endif %}

            {% if not host and game["state"] == "created" %}
            <p>Waiting for other players to join...</p>
            {% endif %}
        </div>

        <div class="vertical-line"></div>

        <div class="cards-display">
            {% for pic in game["removed_character_pics"] %}
            <img src="/static/images/characters/{{pic}}" alt="{{ pic }}" class="cards-img" title="{{ pic }}"/>
            {% endfor %}
        </div>

        {% if player_drawn_card_pics %}
        <div class="vertical-line"></div>

        <p>Drawn cards: </p>

        <div class="cards-display">
            {% for pic in player_drawn_card_pics %}
            <img src="/static/images/districts/{{pic}}" alt="{{ pic }}" class="cards-img" title="{{ pic }}"/>
            {% endfor %}
        </div>
        {% endif %}
    </div>

    {% for player in players %}
    <hr>
    <div class="player-display">
        <div class="player-display-properties">
            <p><strong>Seat</strong>: {{ player["seat"] }}</p>
            <p><strong>Score</strong>: {{ player["score"] }}</p>
            <p><strong>Name</strong>: {{ player["name"] }}</p>
            <p><strong>Coins</strong>: {{ player["coins"] }}</p>
            <p><strong>King</strong>: {{ player["king"] }}</p>
            <p><strong>Protected</strong>: {{ player["protected"] }}</p>

            {% if player_uuid_select_expected == player["uuid"] and player_uuid != player["uuid"] %}
            <p><strong>Expected to select a character!</strong></p>
            {% endif %}

            {% if game["state"] == "selection_phase" and player["uuid"] == player_uuid and player["select_expected"] %}
            <form action="{{ url_for('select_character', game_uuid=game['uuid'], player_uuid=player_uuid, amount_players=game['amount_players'], player_king=player['king'], amount_removed_characters=amount_removed_characters) }}" method="post">
                <p>Pick a character for this round:</p>
                <select name="character-name">
                    {% for character in game['possible_characters'] %}
                    <option value="{{ character['name'] }}">{{ character['name'] }}</option>
                    {% endfor %}
                </select>

                {% if game["amount_players"] == 2 and not player['king'] or game["amount_players"] == 2 and amount_removed_characters > 1 %}
                <p>Pick a character to remove for this round:</p>
                <select name="character-remove">
                    {% for character in game['possible_characters'] %}
                    <option value="{{ character['name'] }}">{{ character['name'] }}</option>
                    {% endfor %}
                </select>
                {% endif %}

                <button type="submit">Select</button>
            </form>
            {% endif %}

            {% if game["state"] == "turn_phase" and player["uuid"] == player_uuid and game["character_turn"] == player["current_character"]["name"] %}

            {% if not player["current_character"]["income_received"] and not player["drawn_cards"] %}
            <form action="{{ url_for('receive_income', game_uuid=game['uuid'], player_uuid=player_uuid) }}" method="post">
                <p>Receive income:</p>
                <select name="income-type">
                    <option value="coins">2 coins</option>
                    <option value="cards">2 cards and keep 1</option>
                </select>
                <button type="submit">Receive</button>
            </form>
            {% endif %}

            {% if player["drawn_cards"] %}
            <form action="{{ url_for('keep_card', game_uuid=game['uuid'], player_uuid=player_uuid) }}" method="post">
                <p>Pick which card you want to keep:</p>
                <select name="card-keep">
                    {% for card in player['drawn_cards'] %}
                    <option value="{{ card['name'] }}">{{ card['name'] }}</option>
                    {% endfor %}
                </select>
                <button type="submit">Keep</button>
            </form>
            {% endif %}

            {% if player["current_character"]["income_received"] and player["current_character"]["built"] < building_limit %}
            <form action="{{ url_for('build_district', game_uuid=game['uuid'], player_uuid=player_uuid, player_buildings=player_buildings) }}" method="post">
                <p>Pick which district you want to build:</p>
                <select name="district-name">
                    {% for card in player['cards'] %}
                    <option value="{{ card['name'] }}">{{ card['name'] }}</option>
                    {% endfor %}
                </select>
                <button type="submit">Build</button>
            </form>
            {% endif %}

            {% if player["current_character"]["income_received"] %}
            <form action="{{ url_for('end_turn', game_uuid=game['uuid'], player_uuid=player_uuid) }}" method="post">
                <div class="home-button">
                    <input type="submit" name="end_turn" value="End turn" class="game-buttons"/>
                </div>
            </form>
            {% endif %}

            {% endif %}
        </div>

        <div class="vertical-line"></div>

        <div class="cards-display">
            {% for pic in player["character_pics"] %}
            <img src="/static/images/characters/{{pic}}" alt="{{ pic }}" class="cards-img" title="{{ pic }}"/>
            {% endfor %}
        </div>

        <div class="vertical-line"></div>

        <div class="cards-display">
            {% for pic in player["card_pics"] %}
            <img src="/static/images/districts/{{pic}}" alt="{{ pic }}" class="cards-img" title="{{ pic }}"/>
            {% endfor %}
        </div>

        <div class="vertical-line"></div>

        <div class="cards-display">
            {% for pic in player["building_pics"] %}
            <img src="/static/images/districts/{{pic}}" alt="{{ pic }}" class="cards-img" title="{{ pic }}"/>
            {% endfor %}
        </div>
        <div class="vertical"></div>
    </div>

    {% endfor %}
</div>
</body>
</html>